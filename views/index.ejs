<!DOCTYPE html>
<html lang="<%= lang %>">
<head>
  <meta charset="UTF-8" />
  <title>CSV Diff App â€” CSN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <main class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <h1 id="t_title">Comparar CSV por CSN</h1>
      <label style="color:#94a3b8;">
        <span id="t_language">Idioma</span>:
        <select id="langSelect">
          <option value="es" <%= lang==='es'?'selected':'' %> >EspaÃ±ol</option>
          <option value="en" <%= lang==='en'?'selected':'' %> >English</option>
        </select>
      </label>
    </div>

    <p id="t_hint" class="hint">
      Sube <strong>filters.csv</strong>, <strong>draft.csv</strong> y <strong>specialty.csv</strong>. Todo se procesa como JSON, sin base de datos.
    </p>

    <section class="card">
      <h2 id="t_step1">1) Cargar archivos</h2>
      <form id="csvForm">
        <div class="grid">
          <label class="file">
            <span>filters.csv</span>
            <input type="file" name="filters" accept=".csv" required />
          </label>
          <label class="file">
            <span>draft.csv</span>
            <input type="file" name="draft" accept=".csv" required />
          </label>
          <label class="file">
            <span>specialty.csv</span>
            <input type="file" name="specialty" accept=".csv" required />
          </label>
        </div>
        <button type="submit" class="primary" id="t_process_btn">Procesar datos</button>
        <div id="status"></div>
      </form>
    </section>

    <section class="card">
      <h2 id="t_step2">2) Resultados</h2>

      <div class="result-block">
        <h3 id="t_res1_title">trips_In_Filters_Not_In_Specialty.csv</h3>
        <div class="actions">
          <a id="downloadCsv1" class="button" href="#" download="trips_In_Filters_Not_In_Specialty.csv" style="display:none;">â¬‡ <span id="t_download">Descargar CSV</span></a>
        </div>
        <div id="table1" class="table-wrapper empty">Sin datos</div>
      </div>

      <div class="result-block">
        <h3 id="t_res2_title">trips_In_Specialty_Not_In_Filters.csv</h3>
        <div class="actions">
          <a id="downloadCsv2" class="button" href="#" download="trips_In_Specialty_Not_In_Filters.csv" style="display:none;">â¬‡ <span id="t_download2">Descargar CSV</span></a>
        </div>
        <div id="table2" class="table-wrapper empty">Sin datos</div>
      </div>
    </section>

    <!-- NUEVA SECCIÃ“N: BÃšSQUEDA EN DRAFT -->
    <section class="card">
      <h2 id="t_step3">3) BÃºsqueda en Draft.csv</h2>
      <p class="hint" id="t_search_hint">
        Busca por <strong>PACE MRN</strong> o <strong>Patient</strong>.
      </p>
      <div class="grid" style="grid-template-columns:1fr auto;">
        <input id="searchInput" type="text" placeholder="Criterio de bÃºsqueda (ej. Caro, SDP10035365)" />
        <button id="searchBtn" class="button" type="button">ðŸ”Ž <span id="t_search_btn">Buscar</span></button>
      </div>
      <div id="searchTable" class="table-wrapper empty">Sin datos</div>
    </section>

    <footer>
      <small id="t_footer">Hecho con Node.js + Express + EJS. No se guarda nada en disco.</small>
    </footer>
  </main>

  <script>
    window.__APP_LANG__ = "<%= lang %>";
  </script>
  <script src="/script.js"></script>
</body>
</html>
